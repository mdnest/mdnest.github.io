---
layout: post
title:  "Does more people at the bus stop mean the bus is coming sooner? Bayesian approach."
date:   2020-03-20 22:18:10 +0000
---

If you use public transit frequently then you probably encountered this thought:

> I just showed up at the bus stop, and I'm not sure when the next bus is coming, but there are a lot of people here waiting, so it is probably coming sooner rather than later.

As it turns out, the probabilistic intuition that justifies this idea makes good use of Bayes' theorem! So, let's set up a mathematical model of waiting on the bus and see how Bayes' theorem help us. Let's make some assumptions:

1. Bus comes every 30 minutes, exactly.
2. You arrive at the bus stop at a random time between 0 and 30 minutes since the last bus.
3. Other riders arrive at the bus stop with an average rate of 1 rider every 10 minutes.
4. Other riders arrive at the bus stop independently of one another.

Assumptions 3 and 4 guarantee that the other bus riders arrive at the bus stop according to what is known as a *Poisson process*. Poisson processes are a simple type of random process which can be used to model the number of times some random event occurs in a fixed amount of time. For example, you might use a Poisson process to model the number of customers that walk into your store on a given day, or the number of red cars you see drive by your window on a given afternoon.

Anyway, to every Poisson process corresponds its *rate*, which we denote by $\lambda$. The rate tells us how many events are expected to occur in a given time interval. From assumption 3, we said the riders show up 1 every 10 minutes. But there is a caveat... the length of the time interval in which the riders arrive depends on when you, the observer, showed up (the random variable $T$). This is where things get Bayesian...

Since we expect 1 rider every 10 minutes, and all the riders should have arrived at the bus stop in $T$ minutes (since you are observing them all when you arrive), this means the Poisson process should have rate $\lambda=T/10$.


```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
```

First, let's generate a dataset consisting of two columns. The first column will contain the time of arrival at the bus stop, which is sampled uniformly between 0 and 30 minutes. The second column contains the number of riders waiting for the bus which were observed upon arriving at the bus stop. These numbers are obtained by sampling a Poisson distribrution whose parameter $\lambda$ is the time of arrival at the bus stop multiplied by the inherent arrival rate of the riders, which we assumed to be 0.1.


```python
N = 10**6

t_sample = np.random.uniform(low=0, high=30, size=N)
x_sample = np.random.poisson(lam=0.1*t_sample, size=N)

data = pd.DataFrame(data={'arrival_time': t_sample,
                          'num_of_riders': x_sample})
```

The following plot shows the distribution of riders we observe upon arriving at the bus stop.

The plot shows that one-third of the time we arrive at the bus stop when there is no one else waiting. That is a good time to listen to music out loud or hum a song you are thinking about. One-fourth of the time there is one person waiting, one fifth of the time there are two people waiting, etc... 

Note that this plot does not match that of a Poisson distribution since we are accounting for many separate Poisson distributions with parameters random chosen between 0 and 3.


```python
data['arrival_time'].mean()
```




    15.01647753626252




```python
data[data.num_of_riders == 0]['arrival_time'].mean()
```




    8.443493461127641



Now we have some numerical evidence to support the idea that more riders at the bus stop implies a shorter waiting time. Let's use Bayesian analysis to show this mathematically. The first piece is our prior distribution on our waiting time before observing any data. That is, when do we think we will arrive at the bus stop and how long our waiting time will be? As we stated earlier, we assume this is uniformly distributed between 0 and 30. We can write the probabiltiy distribution function of $t$ as follows:
$$ p(t) = \frac{1}{30}, \quad 0 \leq t \leq 30 $$

Next we have the distribution of the number of riders we see upon arriving at the bus stop, which depends on the time we arrive. This is written as a conditional probability distribution, and probability density function is that of a Poisson random variable with rate $\lambda=\frac{t}{10}$:

$$ p(x|t) = \frac{\left(\frac{t}{10}\right)^x e^{-\frac{t}{10}}}{x!}, \quad x=0,1,2,\dots$$

$$ p(x) = \int_{0}^{30} p(x|t) p(t) \, dt = \int_{0}^{30} \frac{\left(\frac{t}{10}\right)^x e^{-\frac{t}{10}}}{x!} \frac{1}{30} \, dt $$


```python
plt.hist(data['num_of_riders'],bins=np.arange(10),ec='k')
plt.xlabel('Numbers of riders')
plt.ylabel('Count')
plt.show()
```


![png](/assets/images/output_12_0.png)



```python
average_wait_time = [30 - data[data.num_of_riders == i]['arrival_time'].mean() for i in np.arange(10)]

plt.plot(average_wait_time,'bo')
plt.xlabel('Number of riders')
plt.ylabel('Average wait time')
plt.show()
```


![png](/assets/images/output_13_0.png)

